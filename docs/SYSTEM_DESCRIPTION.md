# Общее описание системы

## 1. Назначение системы

Разрабатываемая система представляет собой **edge-ориентированную платформу управления торговлей и складом (POS + WMS)**, предназначенную для автономной эксплуатации в розничных и складских точках.

Система ориентирована на:
- работу в условиях **нестабильного или отсутствующего интернета**;
- эксплуатацию на **одном компактном edge-сервере** (SBC Orange Pi 5);
- высокую надёжность и предсказуемость поведения;
- соответствие требованиям фискализации через ОФД.

Система может использоваться в:
- розничных магазинах;
- торговых павильонах;
- складах и распределительных центрах;
- удалённых точках продаж.

---

## 2. Ключевая идея и философия

В основе системы лежит концепция **offline-first edge computing**:

- все критически важные операции выполняются **локально**;
- потеря интернет-соединения **не блокирует торговлю**;
- внешние интеграции выполняются асинхронно;
- единая точка входа и строгая изоляция сервисов обеспечивают безопасность.

Система проектируется как **самодостаточный торговый узел**, не зависящий от облака для повседневной работы.

---

## 3. Аппаратно-программная платформа

### 3.1 Аппаратная платформа

- SBC: **Orange Pi 5**
- Архитектура: ARM64 (RK3588)
- ОЗУ: от 8 ГБ
- Накопитель: eMMC / NVMe / SSD

### 3.2 Операционная система

- Linux (Armbian или Ubuntu Server)
- Работа в режиме 24/7
- Поддержка аппаратного watchdog и ZRAM

---

## 4. Общая архитектура системы

Система построена по **микросервисной архитектуре**, развёрнутой на одном edge-устройстве.

Физически сервисы работают как независимые процессы, логически — как изолированные микросервисы.

### 4.1 Архитектурные принципы

- systemd-first (без контейнеров на production)
- отказ от лишних слоёв абстракции
- минимизация потребления ресурсов
- предсказуемый запуск и восстановление

---

## 5. Компоненты системы

### 5.1 Backend

Backend реализован на **Java (Spring Boot / Spring Cloud)** и включает следующие сервисы:

- **API Gateway** — единая точка входа для клиентов
- **Authorization Service** — аутентификация и авторизация (OAuth2)
- **POS Service** — кассовые операции и чеки
- **WMS Service** — складской учёт
- **Search Service** — полнотекстовый поиск
- **Catalog Service** — товары и цены
- **Printer Service** — печать чеков
- **OFD Sync Service** — взаимодействие с ОФД
- **License Service** — лицензирование и привязка к устройству

### 5.2 Frontend

- Web-клиент (Vue.js)
- Доступ через браузер в локальной сети
- Поддержка сканеров штрихкодов (Web API)
- Минимальные требования к рабочим станциям

---

## 6. Сетевая модель и безопасность

Система использует принцип **"единственной точки входа"**:

- доступ из локальной сети разрешён только к API Gateway;
- все остальные сервисы недоступны напрямую;
- внутренняя коммуникация осуществляется через localhost.

Безопасность обеспечивается сочетанием:
- сетевой фильтрации;
- изоляции сервисов средствами systemd;
- строгого контроля исходящего трафика.

---

## 7. Хранение данных

Все данные хранятся **локально** на edge-устройстве.

- СУБД: PostgreSQL
- Одна инстанция БД
- Логическое разделение по схемам
- **Elasticsearch** для задач полнотекстового поиска

База данных является **единственным источником истины** (Single Source of Truth).

---

## 8. Offline-first поведение

Система сохраняет полную работоспособность при отсутствии интернета:

- продажи и складские операции не блокируются;
- чеки сохраняются в локальной очереди;
- синхронизация с ОФД выполняется после восстановления связи;
- лицензия поддерживает offline grace-period.

---

## 9. Интеграция с оборудованием

Система поддерживает:

- сканеры штрихкодов (через браузер);
- сетевые термопринтеры чеков (ESC/POS);
- стандартные рабочие станции кассиров.

Подключение специализированного ПО на клиентских ПК не требуется.

---

## 10. Эксплуатация и сопровождение

- Все сервисы управляются через systemd
- Автоматический перезапуск при сбоях
- Централизованное логирование через journalctl
- Обновление сервисов без переустановки системы

Система рассчитана на эксплуатацию без постоянного присутствия ИТ-специалиста.

---

## 11. Масштабируемость и развитие

Архитектура системы допускает:

- подключение нескольких касс;
- расширение складской логики;
- добавление центрального сервера агрегации;
- последующую миграцию части сервисов в облако.

---

## 12. Итоговое позиционирование

Разрабатываемая система представляет собой:

- автономный торгово-складской узел;
- промышленное edge-решение;
- альтернативу облачным POS-системам;
- основу для масштабируемой торговой платформы.

Система ориентирована на стабильную, безопасную и предсказуемую работу в реальных условиях эксплуатации.

---

**Конец общего описания**

